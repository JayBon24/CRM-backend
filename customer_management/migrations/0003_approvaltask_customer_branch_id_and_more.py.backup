# Generated by Django 4.2.14 on 2025-12-29 19:45

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('customer_management', '0002_schedule_schedulereminder_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='ApprovalTask',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('approval_type', models.CharField(choices=[('LEAD_CLAIM', '申领线索'), ('LEAD_CREATE', '新增线索'), ('HANDOVER', '客户转交')], max_length=32, verbose_name='审批类型')),
                ('approval_chain', models.JSONField(default=list, help_text='按角色顺序排列的审批链', verbose_name='审批链')),
                ('current_step', models.IntegerField(default=0, verbose_name='当前审批步骤')),
                ('current_approver_role', models.CharField(blank=True, max_length=32, null=True, verbose_name='当前审批角色')),
                ('status', models.CharField(choices=[('pending', '待审批'), ('approved', '已通过'), ('rejected', '已驳回')], default='pending', max_length=16, verbose_name='审批状态')),
                ('related_data', models.JSONField(blank=True, default=dict, null=True, verbose_name='关联数据')),
                ('reject_reason', models.TextField(blank=True, null=True, verbose_name='驳回原因')),
                ('applicant', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approval_applications', to=settings.AUTH_USER_MODEL, verbose_name='申请人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
            ],
            options={
                'verbose_name': '审批任务',
                'verbose_name_plural': '审批任务',
                'db_table': 'customer_approval_task',
            },
        ),
        migrations.AddField(
            model_name='customer',
            name='branch_id',
            field=models.IntegerField(blank=True, help_text='分所 ID', null=True, verbose_name='分所 ID'),
        ),
        migrations.AddField(
            model_name='customer',
            name='client_grade',
            field=models.CharField(blank=True, choices=[('A', 'A'), ('B', 'B'), ('C', 'C'), ('D', 'D')], max_length=2, null=True, verbose_name='客户等级'),
        ),
        migrations.AddField(
            model_name='customer',
            name='collection_category',
            field=models.CharField(blank=True, max_length=64, null=True, verbose_name='催收类别'),
        ),
        migrations.AddField(
            model_name='customer',
            name='followup_count',
            field=models.IntegerField(default=0, verbose_name='跟进次数'),
        ),
        migrations.AddField(
            model_name='customer',
            name='lat',
            field=models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True, verbose_name='纬度'),
        ),
        migrations.AddField(
            model_name='customer',
            name='lng',
            field=models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True, verbose_name='经度'),
        ),
        migrations.AddField(
            model_name='customer',
            name='location_status',
            field=models.CharField(blank=True, choices=[('success', '定位成功'), ('fail', '定位失败'), ('denied', '拒绝'), ('offline', '离线')], max_length=32, null=True, verbose_name='定位状态'),
        ),
        migrations.AddField(
            model_name='customer',
            name='owner_user',
            field=models.ForeignKey(blank=True, db_constraint=False, help_text='经办人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_customers', to=settings.AUTH_USER_MODEL, verbose_name='经办人'),
        ),
        migrations.AddField(
            model_name='customer',
            name='owner_user_name',
            field=models.CharField(blank=True, max_length=150, null=True, verbose_name='经办人姓名'),
        ),
        migrations.AddField(
            model_name='customer',
            name='recycle_deadline',
            field=models.DateField(blank=True, null=True, verbose_name='回收截止时间'),
        ),
        migrations.AddField(
            model_name='customer',
            name='recycle_risk_level',
            field=models.CharField(choices=[('none', '无风险'), ('low', '低风险'), ('medium', '中风险'), ('high', '高风险')], default='none', max_length=10, verbose_name='回收风险等级'),
        ),
        migrations.AddField(
            model_name='customer',
            name='referrer',
            field=models.CharField(blank=True, max_length=64, null=True, verbose_name='引荐人'),
        ),
        migrations.AddField(
            model_name='customer',
            name='sales_stage',
            field=models.CharField(choices=[('PUBLIC_POOL', '公海'), ('BLANK', '跟进-空白'), ('MEETING', '跟进-面谈'), ('CASE', '交案'), ('PAYMENT', '回款'), ('WON', '赢单')], default='PUBLIC_POOL', max_length=20, verbose_name='展业状态'),
        ),
        migrations.AddField(
            model_name='customer',
            name='source_channel',
            field=models.CharField(blank=True, max_length=64, null=True, verbose_name='来源渠道'),
        ),
        migrations.AddField(
            model_name='customer',
            name='status',
            field=models.CharField(choices=[('PUBLIC_POOL', '公海'), ('FOLLOW_UP', '跟进'), ('CASE', '交案'), ('PAYMENT', '回款'), ('WON', '赢单')], default='PUBLIC_POOL', max_length=20, verbose_name='生命周期状态'),
        ),
        migrations.AddField(
            model_name='customer',
            name='team_id',
            field=models.IntegerField(blank=True, help_text='团队 ID', null=True, verbose_name='团队 ID'),
        ),
        migrations.AddField(
            model_name='customer',
            name='valid_visit_count',
            field=models.IntegerField(default=0, verbose_name='有效拜访次数'),
        ),
        migrations.CreateModel(
            name='VisitRecord',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('visit_time', models.DateTimeField(verbose_name='拜访时间')),
                ('duration', models.IntegerField(default=0, verbose_name='拜访时长（分钟）')),
                ('location_status', models.CharField(choices=[('success', '定位成功'), ('fail', '定位失败'), ('denied', '拒绝'), ('offline', '离线')], max_length=32, verbose_name='定位状态')),
                ('lng', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True, verbose_name='经度')),
                ('lat', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True, verbose_name='纬度')),
                ('address', models.CharField(blank=True, max_length=255, null=True, verbose_name='拜访地址')),
                ('participants', models.JSONField(blank=True, default=list, null=True, verbose_name='参与人员')),
                ('attachments', models.JSONField(blank=True, default=list, null=True, verbose_name='附件')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='visit_creators', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='visits', to='customer_management.customer', verbose_name='关联客户')),
            ],
            options={
                'verbose_name': '拜访记录',
                'verbose_name_plural': '拜访记录',
                'db_table': 'customer_visit_record',
            },
        ),
        migrations.CreateModel(
            name='TransferLog',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('transfer_reason', models.CharField(blank=True, max_length=200, null=True, verbose_name='转交原因')),
                ('status', models.CharField(choices=[('pending', '待审批'), ('completed', '已完成'), ('rejected', '已驳回')], default='pending', max_length=16, verbose_name='状态')),
                ('approval_task', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transfer_logs', to='customer_management.approvaltask', verbose_name='审批任务')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='transfer_logs', to='customer_management.customer', verbose_name='关联客户')),
                ('from_user', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transfer_from_logs', to=settings.AUTH_USER_MODEL, verbose_name='转出人')),
                ('to_user', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transfer_to_logs', to=settings.AUTH_USER_MODEL, verbose_name='转入人')),
            ],
            options={
                'verbose_name': '转交日志',
                'verbose_name_plural': '转交日志',
                'db_table': 'customer_transfer_log',
            },
        ),
        migrations.CreateModel(
            name='RecoveryPayment',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('pay_time', models.DateTimeField(verbose_name='回款时间')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=14, verbose_name='回款金额')),
                ('collection_category', models.CharField(choices=[('arbitration', '仲裁'), ('mediation', '调解'), ('litigation', '诉讼')], max_length=32, verbose_name='催收类别')),
                ('voucher_attachments', models.JSONField(blank=True, default=list, null=True, verbose_name='凭证附件')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payment_creators', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='recovery_payments', to='customer_management.customer', verbose_name='关联客户')),
            ],
            options={
                'verbose_name': '回款记录',
                'verbose_name_plural': '回款记录',
                'db_table': 'customer_recovery_payment',
            },
        ),
        migrations.CreateModel(
            name='LegalFee',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('pay_time', models.DateTimeField(verbose_name='支付时间')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=14, verbose_name='支付金额')),
                ('voucher_attachments', models.JSONField(blank=True, default=list, null=True, verbose_name='凭证附件')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='legal_fee_creators', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='legal_fees', to='customer_management.customer', verbose_name='关联客户')),
            ],
            options={
                'verbose_name': '律师费用',
                'verbose_name_plural': '律师费用',
                'db_table': 'customer_legal_fee',
            },
        ),
        migrations.CreateModel(
            name='FollowupRecord',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('followup_type', models.CharField(choices=[('phone', '电话'), ('wechat', '微信'), ('meeting', '面谈'), ('other', '其他')], max_length=32, verbose_name='跟进方式')),
                ('summary', models.TextField(blank=True, null=True, verbose_name='跟进摘要')),
                ('conclusion', models.CharField(blank=True, max_length=200, null=True, verbose_name='跟进结论')),
                ('attachments', models.JSONField(blank=True, default=list, null=True, verbose_name='附件')),
                ('next_plan_at', models.DateTimeField(blank=True, null=True, verbose_name='下次计划时间')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='followup_creators', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='followups', to='customer_management.customer', verbose_name='关联客户')),
            ],
            options={
                'verbose_name': '跟进记录',
                'verbose_name_plural': '跟进记录',
                'db_table': 'customer_followup_record',
            },
        ),
        migrations.CreateModel(
            name='Contract',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('contract_no', models.CharField(max_length=64, verbose_name='合同编号')),
                ('amount', models.DecimalField(decimal_places=2, default=0, max_digits=14, verbose_name='合同金额')),
                ('term', models.CharField(blank=True, max_length=64, null=True, verbose_name='合同期限')),
                ('service_type', models.CharField(blank=True, max_length=64, null=True, verbose_name='服务类型')),
                ('client_subject', models.CharField(blank=True, max_length=128, null=True, verbose_name='客户主体')),
                ('status', models.CharField(choices=[('pending', '待确认'), ('confirmed', '已确认')], default='pending', max_length=16, verbose_name='合同状态')),
                ('confirmed_at', models.DateTimeField(blank=True, null=True, verbose_name='确认时间')),
                ('attachments', models.JSONField(blank=True, default=list, null=True, verbose_name='附件')),
                ('confirmed_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='confirmed_contracts', to=settings.AUTH_USER_MODEL, verbose_name='确认人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='contracts', to='customer_management.customer', verbose_name='关联客户')),
            ],
            options={
                'verbose_name': '客户合同',
                'verbose_name_plural': '客户合同',
                'db_table': 'customer_contract',
            },
        ),
        migrations.AddField(
            model_name='approvaltask',
            name='related_customer',
            field=models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='approval_tasks', to='customer_management.customer', verbose_name='关联客户'),
        ),
        migrations.CreateModel(
            name='ApprovalHistory',
            fields=[
                ('id', models.BigAutoField(help_text='Id', primary_key=True, serialize=False, verbose_name='Id')),
                ('description', models.CharField(blank=True, help_text='描述', max_length=255, null=True, verbose_name='描述')),
                ('modifier', models.CharField(blank=True, help_text='修改人', max_length=255, null=True, verbose_name='修改人')),
                ('dept_belong_id', models.CharField(blank=True, help_text='数据归属部门', max_length=255, null=True, verbose_name='数据归属部门')),
                ('update_datetime', models.DateTimeField(auto_now=True, help_text='修改时间', null=True, verbose_name='修改时间')),
                ('create_datetime', models.DateTimeField(auto_now_add=True, help_text='创建时间', null=True, verbose_name='创建时间')),
                ('approver_role', models.CharField(blank=True, max_length=32, null=True, verbose_name='审批角色')),
                ('action', models.CharField(choices=[('approve', '通过'), ('reject', '驳回')], max_length=16, verbose_name='审批动作')),
                ('comment', models.TextField(blank=True, null=True, verbose_name='审批意见')),
                ('approval_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='审批时间')),
                ('approval_task', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='histories', to='customer_management.approvaltask', verbose_name='审批任务')),
                ('approver', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approval_histories', to=settings.AUTH_USER_MODEL, verbose_name='审批人')),
                ('creator', models.ForeignKey(db_constraint=False, help_text='创建人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_query_name='creator_query', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
            ],
            options={
                'verbose_name': '审批历史',
                'verbose_name_plural': '审批历史',
                'db_table': 'customer_approval_history',
            },
        ),
    ]

# 小程序登录接口测试指南

## 测试账号

系统初始化了以下测试账号，默认密码都是：`admin123456`

| 用户名 | 手机号 | 角色 | 说明 |
|--------|--------|------|------|
| superadmin | 13333333333 | 超级管理员 | 拥有所有权限 |
| admin | 18888888888 | 管理员 | 管理员权限 |
| test | 18888888888 | 测试人员 | 普通用户 |

## 接口信息

- **接口地址**: `POST /api/miniapp/login/`
- **Content-Type**: `application/json`

## 密码加密

前端需要对密码进行 MD5 加密后再发送：

```javascript
// admin123456 的 MD5 值
const password = "0192023a7bbd73250516f069df18b500";
```

## 测试方法

### 方法1：使用 Postman/Apifox

1. **创建 POST 请求**
   ```
   POST http://localhost:8000/api/miniapp/login/
   ```

2. **设置请求头**
   ```
   Content-Type: application/json
   ```

3. **请求体（用户名登录）**
   ```json
   {
     "username": "superadmin",
     "password": "0192023a7bbd73250516f069df18b500"
   }
   ```

4. **请求体（手机号登录）**
   ```json
   {
     "username": "13333333333",
     "password": "0192023a7bbd73250516f069df18b500"
   }
   ```

### 方法2：使用 curl 命令

```bash
# 用户名登录
curl -X POST http://localhost:8000/api/miniapp/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"superadmin","password":"0192023a7bbd73250516f069df18b500"}'

# 手机号登录
curl -X POST http://localhost:8000/api/miniapp/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"13333333333","password":"0192023a7bbd73250516f069df18b500"}'
```

### 方法3：使用 Python 测试脚本

运行测试脚本：
```bash
python test_miniapp_login.py
```

### 方法4：前端 Mock 数据

如果后端还没启动，前端可以使用 Mock 数据：

```javascript
// mock/miniapp.js
export default {
  // 模拟登录成功
  'POST /api/miniapp/login/': (req, res) => {
    const { username, password } = req.body;
    
    // 验证密码（admin123456 的 MD5）
    if (password === '0192023a7bbd73250516f069df18b500') {
      res.json({
        code: 2000,
        msg: '请求成功',
        data: {
          access: 'mock_access_token_' + Date.now(),
          refresh: 'mock_refresh_token_' + Date.now(),
          username: username,
          name: '测试用户',
          userId: 1,
          avatar: 'https://via.placeholder.com/100',
          user_type: 1,
          pwd_change_count: 0,
          dept_info: {
            dept_id: 1,
            dept_name: '技术部'
          },
          role_info: [
            {
              id: 1,
              name: '普通用户',
              key: 'user'
            }
          ]
        }
      });
    } else {
      res.json({
        code: 4000,
        msg: '账号/密码错误',
        data: null
      });
    }
  }
}
```

## 成功响应示例

```json
{
  "code": 2000,
  "msg": "请求成功",
  "data": {
    "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "username": "superadmin",
    "name": "超级管理员",
    "userId": 1,
    "avatar": null,
    "user_type": 0,
    "pwd_change_count": 0,
    "dept_info": {
      "dept_id": 1,
      "dept_name": "dvadmin"
    },
    "role_info": [
      {
        "id": 1,
        "name": "管理员",
        "key": "admin"
      }
    ]
  }
}
```

## 错误响应示例

### 账号不存在
```json
{
  "code": 4000,
  "msg": "您登录的账号不存在",
  "data": null
}
```

### 密码错误
```json
{
  "code": 4000,
  "msg": "账号/密码错误;重试4次后将被锁定~",
  "data": null
}
```

### 账号被锁定
```json
{
  "code": 4000,
  "msg": "账号已被锁定,联系管理员解锁",
  "data": null
}
```

## 常用密码的 MD5 值

| 原始密码 | MD5 值 |
|---------|--------|
| admin123456 | 0192023a7bbd73250516f069df18b500 |
| 123456 | e10adc3949ba59abbe56e057f20f883e |
| 888888 | 21218cca77804d2ba1922c33e0151105 |

## 在线 MD5 加密工具

- https://www.md5hashgenerator.com/
- https://tool.oschina.net/encrypt?type=2

## 注意事项

1. 确保后端服务已启动（默认端口 8000）
2. 密码必须先 MD5 加密再发送
3. 小程序登录不支持邮箱登录
4. 连续失败 5 次会锁定账号
